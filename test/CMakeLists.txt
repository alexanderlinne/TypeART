function(configure_must_lit_site_cfg input output)
# This function provides an automatic way to 'configure'-like generate a file
# based on a set of common and custom variables, specifically targeting the
# variables needed for the 'lit.site.cfg' files. This function bundles the
# common variables that any Lit instance is likely to need, and custom
# variables can be passed in.

  set(MUSTPASS_PROJECT_DIR ${CMAKE_SOURCE_DIR})
  set(MUSTPASS_BINARY_DIR ${CMAKE_BINARY_DIR})
  set(MUSTPASS_LIBRARY_DIR ${CMAKE_BINARY_DIR}/lib)
  set(LIT_SITE_CFG_IN_HEADER  "## Autogenerated from ${input}\n## Do not edit!")

  configure_file(${input} ${output} @ONLY)
endfunction()


add_format_target(format-tests
  "Formats project test source files"
  TARGETS *.c
)

configure_must_lit_site_cfg(
  ${CMAKE_CURRENT_SOURCE_DIR}/lit.site.cfg.in
  ${CMAKE_CURRENT_BINARY_DIR}/lit.site.cfg
)

set(MUSTPASS_TEST_DEPENDS MustSupportPass)
add_lit_testsuite(lit-pass-test 
  "Running the MUST support pass tests"
  ${CMAKE_CURRENT_SOURCE_DIR}
  ARGS -v
  PARAMS mustpass_site_config=${CMAKE_CURRENT_BINARY_DIR}/lit.site.cfg
  DEPENDS ${MUSTPASS_TEST_DEPENDS}
)

add_test(
  NAME ctest_lit_suite
  COMMAND llvm-lit --param mustpass_site_config=${CMAKE_CURRENT_BINARY_DIR}/lit.site.cfg ${CMAKE_CURRENT_SOURCE_DIR}
)
